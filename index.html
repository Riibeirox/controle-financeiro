<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<title>Controle Financeiro Familiar</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background:#f3f4f6; margin:0; }
main { max-width:900px; margin:30px auto; background:#fff; padding:24px; border-radius:12px; }
h1,h2 { margin-top:0 }
.grid { display:grid; grid-template-columns: repeat(4,1fr); gap:12px; }
input,select,button { padding:10px; border-radius:8px; border:1px solid #ccc; }
button { background:#0b2545; color:#fff; cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th,td { border-bottom:1px solid #ddd; padding:8px; }
.resumo { display:flex; gap:20px; margin:20px 0; }
.card { padding:12px; background:#eef2ff; border-radius:10px; }
</style>
</head>

<body>
<main>
<h1>Controle Financeiro</h1>

<div class="grid">
  <input type="date" id="data">
  <input type="number" id="valor" placeholder="Valor">
  <select id="tipo">
    <option>Despesa</option>
    <option>Receita</option>
  </select>
  <select id="natureza"></select>
</div>

<button onclick="salvar()">Salvar</button>

<div class="resumo">
  <div class="card">Receitas: R$ <span id="totRec">0</span></div>
  <div class="card">Despesas: R$ <span id="totDes">0</span></div>
  <div class="card">Saldo: R$ <span id="saldo">0</span></div>
</div>

<h2>Histórico</h2>
<table>
<thead>
<tr><th>Data</th><th>Tipo</th><th>Natureza</th><th>Valor</th></tr>
</thead>
<tbody id="lista"></tbody>
</table>
</main>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw3pKAXK6dWt2nKX2-V7T6iAMfqY_ypIjJIzyjaoQL-NbLLlYNvUTts8MB_ywi9nQGP/exec";

const naturezas = [
"Adiantamento","Salário","Décimo","Renda Extra",
"Condominio e gás","Taxa extra","Alimentação (mercado)","Almoço",
"Conta de Luz","Gasolina","Cartão XP","Cartão Nubank","Internet",
"IPTU","Vento Divino","Celulares","Jiujitsu","Escola Aurora",
"Dentista","Seguro","Lavagem carro","Nina","Farmacia",
"Viagem Itabuna","Aquários","Lazer","Extraordinárias","Outros","Investimentos"
];

naturezas.forEach(n=>{
  const o=document.createElement("option");
  o.value=o.text=n;
  natureza.appendChild(o);
});

data.valueAsDate=new Date();

function salvar(){
  fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain"},
    body:JSON.stringify({
      action:"save",
      data:data.value,
      valor:valor.value,
      tipo:tipo.value,
      natureza:natureza.value
    })
  }).then(()=>{ valor.value=""; carregar(); });
}

function carregar(){
  fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain"},
    body:JSON.stringify({action:"list"})
  }).then(r=>r.json()).then(j=>{
    let tr=0,td=0;
    lista.innerHTML="";
    j.payload.receitas.forEach(l=>{
      tr+=Number(l[1]);
      lista.innerHTML+=linha(l,"Receita");
    });
    j.payload.despesas.forEach(l=>{
      td+=Number(l[1]);
      lista.innerHTML+=linha(l,"Despesa");
    });
    totRec.textContent=tr.toFixed(2);
    totDes.textContent=td.toFixed(2);
    saldo.textContent=(tr-td).toFixed(2);
  });
}

function linha(l,t){
  return `<tr>
    <td>${l[0]}</td>
    <td>${t}</td>
    <td>${l[2]}</td>
    <td>${Number(l[1]).toFixed(2)}</td>
  </tr>`;
}

carregar();
</script>
</body>
</html>
